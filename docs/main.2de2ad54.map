{"version":3,"sources":["constant.ts","player/player.ts","player/sample.ts","main.ts"],"names":[],"mappings":"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","file":"main.2de2ad54.map","sourceRoot":"..\\src","sourcesContent":["export const playBtn = document.getElementById(\"play\")!;\r\nexport const stopBtn = document.getElementById(\"stop\")!;\r\nexport const gainRange = <HTMLInputElement>document.getElementById(\"gain\")!;\r\nexport const sineSpeed = <HTMLInputElement>document.getElementById(\"sinewave-speed\")!;\r\nexport const sineLoadBtn = document.getElementById(\"load-sinewave\")!;\r\n\r\nexport const sampleSpeed = <HTMLInputElement>document.getElementById(\"sample-speed\")!;\r\nexport const kickLoadBtn = document.getElementById(\"load-kick\")!;\r\nexport const mouseChaosLoadBtn = document.getElementById(\"load-mouse-chaos\")!;","//import { sineWave } from './sample'\r\nexport class ngPlayer {\r\n  audioCtx: AudioContext\r\n  mixerNode: ScriptProcessorNode\r\n  masterGainNode: GainNode\r\n  constructor() {\r\n    this.audioCtx = new AudioContext();\r\n    this.mixerNode = this.audioCtx.createScriptProcessor(1024, 1, 1);\r\n    this.masterGainNode = this.audioCtx.createGain();\r\n    this.masterGainNode.gain.value = 0.5;\r\n    this.masterGainNode.connect(this.audioCtx.destination);\r\n  }\r\n\r\n  load(fn: (this: ScriptProcessorNode, ev: AudioProcessingEvent) => any) {\r\n    this.mixerNode.onaudioprocess = fn;\r\n    //sineWave(0.1)\r\n  }\r\n\r\n  play() {\r\n    this.mixerNode.connect(this.masterGainNode);\r\n  }\r\n\r\n  stop() {\r\n    this.mixerNode.disconnect();\r\n  }\r\n\r\n  getMasterGain() {\r\n    return this.masterGainNode.gain.value;\r\n  }\r\n\r\n  setMasterGain(value: number) {\r\n    console.log(value);\r\n    this.masterGainNode.gain.value = value;\r\n  }\r\n}\r\n","export const sineWave = (speed=0.2, gain=1.0, offset=0) => {\r\n  let x = offset\r\n  return (e: AudioProcessingEvent) => {\r\n    const data = e.outputBuffer.getChannelData(0);\r\n    for (let i = 0; i < data.length; ++i) {\r\n      x+=speed;\r\n      data[i] = Math.sin(x) * gain;\r\n    }\r\n  }\r\n}\r\n\r\nexport const kick = (speed=1, gain=1.0, offset=0, loop=true) => {\r\n  const xmap = []\r\n  const _max = 256;\r\n  for (let i= 0; i < _max; i++) {\r\n    const v = Math.sin( i/_max * (_max - i) ) * (_max - i) / _max * 1.5;\r\n    xmap.push(Math.max(Math.min(v, 1), -1) );\r\n  }\r\n  let x = offset\r\n  const baseSpeed = 0.04;\r\n  speed = baseSpeed * speed;\r\n  return (e: AudioProcessingEvent) => {\r\n    const data = e.outputBuffer.getChannelData(0);\r\n    for (let i = 0; i < data.length; ++i) {\r\n      x += speed;\r\n      if (loop === true && x > xmap.length) x=0;\r\n      if (x > xmap.length) {data[i] = 0.5; continue;}\r\n      const base = Math.floor(x);\r\n      const diff = x - base\r\n      const next = base === xmap.length ?  xmap[0] : xmap[base+1];\r\n      const value = (xmap[base] - (xmap[base] - next) * diff);\r\n      data[i] = value;\r\n    }\r\n  }\r\n}\r\n\r\nexport const mouseChaos = (speed=1) => {\r\n  let x = 0;\r\n  let posx = 0.1, posy = 1;\r\n  window.onmousemove = (e) => {\r\n    posx = e.clientX / document.body.scrollWidth\r\n    posy = e.clientY / document.body.scrollHeight\r\n  }\r\n  return (e: AudioProcessingEvent) => {\r\n    const data = e.outputBuffer.getChannelData(0);\r\n    for (let i = 0; i < data.length; ++i) {\r\n      x += speed * posx;\r\n      data[i] = Math.sin(x) - Math.sin(x) * Math.abs(Math.sin(x)) * posy;\r\n    }\r\n  }\r\n}\r\n\r\n/*\r\nexport const rhythm = (bpm=160) => {\r\n  let x = 0\r\n  return (e: AudioProcessingEvent) => {\r\n    const data = e.outputBuffer.getChannelData(0);\r\n    for (let i = 0; i < data.length; ++i) {\r\n      x+=speed;\r\n      data[i] = Math.sin(x);\r\n    }\r\n  }\r\n}\r\n*/\r\n/*\r\n\r\nexport const sineWave = {\r\n  x: 0,\r\n  play: (e: AudioProcessingEvent) => {\r\n    var data = e.outputBuffer.getChannelData(0);\r\n    for (var i = 0; i < data.length; ++i) {\r\n      data[i] = Math.sin(this.x++);\r\n    }\r\n  }\r\n}\r\n*/","import { playBtn, stopBtn, gainRange, sineLoadBtn, sineSpeed, kickLoadBtn, sampleSpeed, mouseChaosLoadBtn } from './constant'\r\nimport { ngPlayer } from './player/player'\r\nimport { sineWave, kick, mouseChaos } from './player/sample'\r\n\r\nconst player = new ngPlayer\r\n\r\n//player.load()\r\n\r\nplayBtn.onclick = () => {player.play()}\r\nstopBtn.onclick = () => {player.stop()}\r\ngainRange.value = player.getMasterGain().toString()\r\ngainRange.onchange = (e) => {\r\n  player.setMasterGain(parseFloat(gainRange.value))\r\n}\r\nsineSpeed.value = \"0.2\"\r\nsampleSpeed.value = \"1.0\"\r\nsineLoadBtn.onclick = () => {\r\n  player.load(sineWave(parseFloat(sineSpeed.value)))\r\n}\r\nkickLoadBtn.onclick = () => {\r\n  player.load(kick(parseFloat(sampleSpeed.value)))\r\n}\r\nmouseChaosLoadBtn.onclick = () => {\r\n  player.load(mouseChaos(parseFloat(sampleSpeed.value)))\r\n}\r\nplayer.load(sineWave(parseFloat(sineSpeed.value)))"]}